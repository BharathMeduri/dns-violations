# DVE-2017-0008: missing SOA in NOERROR/NODATA response to DS query

## Description

`nominet.uk` is hosted on the Cloudflare DNS servers, and signed. `info.nominet.uk` is an unsigned delegation.

DS queries for `info.nominet.uk` get an RFC 2308 type 3 response - no SOA nor NS records in the authority section.
The missing SOA prevents negative cacheing from working.

With a DO=1 query, the response includes an NSEC proof of nonexistence and an RRSIG NSEC.
This makes BIND fail to recognize the response as a valid negative response.

## Evidence

    
    ; <<>> DiG 9.12.0-dev <<>> +multiline +dnssec +norec @173.245.58.93 www.nominet.uk ds
    ; (1 server found)
    ;; global options: +cmd
    ;; Got answer:
    ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 21
    ;; flags: qr aa; QUERY: 1, ANSWER: 0, AUTHORITY: 4, ADDITIONAL: 1
    
    ;; OPT PSEUDOSECTION:
    ; EDNS: version: 0, flags: do; udp: 512
    ;; QUESTION SECTION:
    ;www.nominet.uk.		IN DS
    
    ;; AUTHORITY SECTION:
    nominet.uk.		3600 IN	SOA curt.ns.cloudflare.com. dns.cloudflare.com. (
    				2023511985 ; serial
    				10000      ; refresh (2 hours 46 minutes 40 seconds)
    				2400       ; retry (40 minutes)
    				604800     ; expire (1 week)
    				3600       ; minimum (1 hour)
    				)
    www.nominet.uk.		3600 IN	NSEC \000.www.nominet.uk. A WKS HINFO MX TXT AAAA LOC SRV CERT SSHFP IPSECKEY RRSIG NSEC TLSA HIP OPENPGPKEY SPF
    nominet.uk.		3600 IN	RRSIG SOA 13 2 3600 (
    				20170127130422 20170125110422 35273 nominet.uk.
    				mlODaZ27eyCwnDTfkudjb+M6x5RfMAGqK1ooNmsh8BeQ
    				8hG5prQiNxzOGc9w23QqakMZ+Y70rdjuJO0c6DPmBw== )
    www.nominet.uk.		3600 IN	RRSIG NSEC 13 3 3600 (
    				20170127130422 20170125110422 35273 nominet.uk.
    				guTjI2Tc6HEH67QV8ozNyafK9YBJ4t8Kxaq+QaezZxIe
    				O8Mq935QmRjbOheI3syb1APoYVyICkG2BzcQHLd4+g== )
    
    ;; Query time: 5 msec
    ;; SERVER: 173.245.58.93#53(173.245.58.93)
    ;; WHEN: Thu Jan 26 12:04:22 GMT 2017
    ;; MSG SIZE  rcvd: 362
    
## Proposed fix

Include the SOA and RRSIG SOA in the negative DS response.

(Other negative responses from Cloudflare include the SOA.)

