# DVE-2018-0002: Microsoft server replies FORMERR for unknown EDNS options

## Description

86.64.239.11 is one of the authoritative name servers for sfr.net (SFR being a big ISP in France). It handles EDNS except when the client uses an option it doesn't know, like NSID or cookies. It then replies FORMERR.

It is clearly a violation of RFC 6891 "Any OPTION-CODE values not understood by a responder or requestor MUST be ignored."

## Evidence

```
% dig +dnssec +bufsize=4096 @86.64.239.11 NS sfr.net

; <<>> DiG 9.10.3-P4-Debian <<>> +dnssec +bufsize=4096 @86.64.239.11 NS sfr.net
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 27995
;; flags: qr aa rd; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 3
;; WARNING: recursion requested but not available

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags: do; udp: 4000
;; QUESTION SECTION:
;sfr.net.	IN NS

;; ANSWER SECTION:
sfr.net.	86400 IN NS ns1.9services.com.
sfr.net.	      86400 IN NS ns2.9services.com.

;; ADDITIONAL SECTION:
ns1.9services.com.	900 IN A 86.64.239.11
ns2.9services.com.	3600 IN	 A 84.96.147.1

;; Query time: 7 msec
;; SERVER: 86.64.239.11#53(86.64.239.11)
;; WHEN: Thu Apr 05 14:17:51 CEST 2018
;; MSG SIZE  rcvd: 117


 % dig +dnssec +bufsize=4096 +nsid @86.64.239.11 NS sfr.net

; <<>> DiG 9.10.3-P4-Debian <<>> +dnssec +bufsize=4096 +nsid @86.64.239.11 NS sfr.net
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: FORMERR, id: 2716
;; flags: qr rd; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1
;; WARNING: recursion requested but not available

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags: do; udp: 4096
; NSID
;; QUESTION SECTION:
;sfr.net.	IN NS

;; Query time: 6 msec
;; SERVER: 86.64.239.11#53(86.64.239.11)
;; WHEN: Thu Apr 05 14:18:06 CEST 2018
;; MSG SIZE  rcvd: 40


%  dig +dnssec +bufsize=4096 +cookie @86.64.239.11 NS sfr.net

; <<>> DiG 9.11.3-1-Debian <<>> +dnssec +bufsize=4096 +cookie @86.64.239.11 NS sfr.net
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: FORMERR, id: 28934
;; flags: qr rd; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1
;; WARNING: recursion requested but not available

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags: do; udp: 4096
; COOKIE: 0fbecb111479660d (echoed)
;; QUESTION SECTION:
;sfr.net.	IN NS

;; Query time: 3 msec
;; SERVER: 86.64.239.11#53(86.64.239.11)
;; WHEN: Thu Apr 05 12:18:32 UTC 2018
;; MSG SIZE  rcvd: 48

```

According to version.bind CH TXT queries, the server is "Microsoft DNS 6.1.7601 (1DB15CD4)".

The second autoritative name server for sfr.net has the same behaviour.

## Workaround

No workarounds are currently known, except not using any EDNS option.

## DNS Operator/Vendor Response

Submitted to the hostmaster on 2018-04-05.

## Metadata

Tags: edns
