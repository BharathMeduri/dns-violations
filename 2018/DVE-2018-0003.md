# DVE-2018-0003: inaccurate NSEC3 answer results in domain unreachability if the resolver applies aggresive negative caching

## Description
Multiple domains were found to return inaccurate NSEC3 record, stating that only TXT records exist for the zone. Resolver with aggressive enabled will fail to validate queries of other query type to this domain before this record expires from the resolver cache.
Lowering the TTL for the NSEC3 record is a recomended way to minimize the impact of the issue, however is still not a complete workaround. Disabling DNSSEC validation on the resolver for the particular domains works, however can not be recommended from the security point of view.

Known domains affected (it is expected there are lot more):
```
wwww.cezdistribuce.cz
lekar-soap.erecept.sukl.cz
cezonline.cez.cz
www.csas.cz
```

## Evidence
See the NSEC3 
```
;; ->>HEADER<<- opcode: QUERY; status: NOERROR; id: 44342
;; Flags: qr aa  QUERY: 1; ANSWER: 0; AUTHORITY: 0; ADDITIONAL: 0

;; QUESTION SECTION
www.cezdistribuce.cz.           A

;; AUTHORITY SECTION
cezdistribuce.cz.       86013   SOA     ns10.cez.cz. netmaster.cezdata.cz. 2018071202 28800 7200 864000 86400
cezdistribuce.cz.       86013   RRSIG   SOA 10 2 86400 20180914102118 20180907102118 26051 cezdistribuce.cz. bMx2+wkjliJRLv8B8pHjKHbI7lVDWUHULgFOozOk/w1Jde09nqpTxJmVhhAFXh1QQbNBOkfIMOIAUKu5Ch4yUquLDL6uKziKnm5Bc2GtUm+C27ZBc3a3/6/3SYvaH1CaJYVNOIj1W81SUkrbIEJ5T2FGp27XaoRrqpkaiNPINyw=
cezdistribuce.cz.       86013   RRSIG   SOA 10 2 86400 20180916182216 20180909182216 45818 cezdistribuce.cz. O+9tXCtKkIA3eWNRbO+651CgtVe6Smjmfm52c4j0MRAXNaHbxXxxL/I5hnweu4QUmGu4/PvcOM5h/tvsRA5VABJWZK8PLMyAOx4ILy2vMf5+9PsvmbOcJZKf3IR3QZtk/9bKcCUpcbhsnJPEMfUFEf893Qw5V01OiojntgfWohA=
s9qm7f772bc6lv8bg0adu5l2emaqk90s.cezdistribuce.cz. 86013        NSEC3   1 0 1 961A671F552A6767 S9QM7F772BC6LV8BG0ADU5L2EMAQK90T TXT
s9qm7f772bc6lv8bg0adu5l2emaqk90s.cezdistribuce.cz. 86013        RRSIG   NSEC3 10 3 86400 20180915151629 20180908151629 26051 cezdistribuce.cz. B+lQuYpiUIRt5WZpQdKqME1hEBJGoSpwf1AxfhHAv8hUI/lhhnCpGvjBCAH1By8QkGLqyGWM14HlpDtZp5zYGSs4tZy5ydBtkMfGMaVs+TyLPsUovdQ1l4Si9Et2bgozE05qnjoxBhE7LaV2GkK42hR31qpCCtFvKS3PeUxOcwQ=
s9qm7f772bc6lv8bg0adu5l2emaqk90s.cezdistribuce.cz. 86013        RRSIG   NSEC3 10 3 86400 20180915151629 20180908151629 45818 cezdistribuce.cz. nKlX0IwTE5m2LP5aXtwSfPPW2kjUMK4S8HbZVPhdgYuFhIcSvvjnEiJlTBHhaDm/LtZpYogLEi9ypw9jga/DesFDaKu5aRvFaj7b97kl3PA3xN/I35m7Uf6jbcS4Puumn85JCwDSn4b9UZGNs5xsXl0oYXWm45caJGBGeUhsBxg=
```

## Proposed fix
The nameserver vendor has to fix the NSEC3 record to include all the available record types

## Workaround
- Lowering TTL on the nameserver for the non-existent record could minimize the impact
- Disabling DNSSEC validation for the domain on validating resolver will ensure reachability of the domain, but will ignore DNSSEC

## Files

None at the moment.

## Metadata
